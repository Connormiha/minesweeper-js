(e=>{var t={};function n(l){if(t[l])return t[l].exports;var s=t[l]={i:l,l:!1,exports:{}};return e[l].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=(e,t,l)=>{n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=(e,t)=>{if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(l,s,(t=>e[t]).bind(null,s));return l},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,"a",t),t},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",n(n.s=6)})([(e,t,n)=>{e.exports={cell:"pxyU",cell_open:"_2wwo",cell_close:"_2nTb",cell_bomb:"_3PRJ",cell_flag:"_2nKh",cell_question:"oHTV",cell_dead:"_2VUv",cell_count_1:"lEzD",cell_count_2:"_3uta",cell_count_3:"_1AAq",cell_count_4:"_173H",cell_count_5:"_1RWx",cell_count_6:"_3Q4i",cell_count_7:"_2p6j",cell_count_8:"z2f4"}},(e,t,n)=>{e.exports={field:"_10po",field_locked:"HZ_P"}},(e,t,n)=>{e.exports={progress:"_3O2Z",progress__inner:"_2dnQ",progress__progress:"_1Yi6",progress__text:"_2Cw3"}},(e,t,n)=>{e.exports={settings:"_1cIi",settings__label:"_19BC","settings__label-text":"_1swJ",settings__input:"gXEs"}},(e,t,n)=>{e.exports={"game-status":"reZE","game-status_state_win":"_1Qbc","game-status_state_in-progress":"_2Wdm","game-status_state_not-started":"_1Q3b","game-status_state_fail":"_1DUz"}},(e,t,n)=>{},function(e,t,n){"use strict";n.r(t),n(5);var l=n(3),s=n.n(l);class i{constructor(e){this.element=document.createElement("label"),this.element.className=s.a.settings__label,this.element.innerHTML=`\n      <span className="${s.a["settings__label-text"]}">\n        ${e.title}\n      </span>\n      <input\n        type="number"\n        min="${e.min}"\n        max="${e.max}"\n        value="${e.value}"\n      >\n    `,this.input=this.element.querySelector("input"),this.input.addEventListener("input",()=>{this.input.value=this.input.value.replace(/\D/g,"")})}}var a=n(0),r=n.n(a);const o=(e,t,n)=>{const l=e%t==0,s=e%t==t-1,i=[];return e+t<n&&i.push(e+t),e-t>=0&&i.push(e-t),l||i.push(e-1,e+t-1,e-t-1),s||i.push(e+1,e+t+1,e-t+1),i.filter(e=>e>=0&&e<n)},d=`${r.a.cell} ${r.a.cell_close}`,c=()=>{const e=document.createElement("button");return e.type="button",e.setAttribute("aria-label","not oppened cell"),e.className=d,e},h=(e,t,n)=>{const l=Boolean(2&t),s=Boolean(1&t),i=l&&s,a=Boolean(4&t),o=Boolean(8&t),d=t>>4,c=[r.a.cell];s||n&&l?((s||n)&&l&&c.push(r.a.cell_bomb),i?c.push(r.a.cell_dead):c.push(r.a.cell_open)):c.push(r.a.cell_close),a&&!s&&c.push(r.a.cell_flag),a&&!l&&n&&c.push(r.a.cell_dead),!o||s||n||l||c.push(r.a.cell_question),d&&s&&!l&&c.push(r.a["cell_count_"+d]),e.className=c.join(" "),e.disabled=s&&0===d,e.setAttribute("aria-label",(e=>4&e?"flag":8&e?"unknown mark":1&e?e>>4!=0?"around bombs "+(e>>4):"opened empty cell":"not oppened cell")(t)),e.textContent=s&&!l&&d?String(d):""};var u=n(2),m=n.n(u),_=n(1),f=n.n(_);const p=[13,32,40,38,37,39];class g{constructor(e,t){this._actions=e,this._isLockedEvents=!1,this._gameState=t,this._progress=(e=>{const t=document.createElement("div");t.className=m.a.progress,t.innerHTML=`\n    <div class="${m.a.progress__inner}">\n      <div class="${m.a.progress__progress}"></div>\n      <div class="${m.a.progress__text}"></div>\n    </div>\n  `;const n=t.querySelector("."+m.a.progress__progress),l=t.querySelector("."+m.a.progress__text);return{element:t,startUpdateProgress(){t.style.display="flex";const s=()=>{if(!e.isRenderInProgres)return void(t.style.display="none");const i=e.totalRendered/e.field.length*100;n.style.width=i+"%",l.innerHTML=`Rendering ${0|i}%`,requestAnimationFrame(s)};requestAnimationFrame(s)}}})(t.field),this.progressElement=this._progress.element,this.element=document.createElement("div"),this.element.className=f.a.field,this.element.addEventListener("click",this),this.element.addEventListener("contextmenu",this),this.element.addEventListener("dblclick",this),this.element.addEventListener("mouseup",this),this.element.addEventListener("keydown",this)}renderAll(){this.element.innerHTML="",this.element.style.width=34*this._gameState.game.width+"px",this.element.className=f.a.field,this._gameState.field.isRenderInProgres=!0,this._gameState.field.totalRendered=0,this._batchTimer=setTimeout(()=>{this._gameState.field.isRenderInProgres&&this._gameState.field.totalRendered/this._gameState.field.field.length<.5&&this._progress.startUpdateProgress()},500),this._renderBatch(0,1e4)}_renderBatch(e,t){const n=document.createDocumentFragment(),l=Math.min(this._gameState.field.field.length,e+t);for(let t=e;t<l;t++)n.appendChild(c());this.element.appendChild(n),this._gameState.field.totalRendered=e+t,l<this._gameState.field.field.length?requestAnimationFrame(()=>{this._renderBatch(e+t,t)}):(this._gameState.field.isRenderInProgres=!1,clearInterval(this._batchTimer))}renderCell(e){const t=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className=`${f.a.field} ${t?f.a.field_locked:""}`,h(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}reRenderAll(){const e=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className=`${f.a.field} ${e?f.a.field_locked:""}`;for(let e=0;e<this._gameState.field.field.length;e++)2&e&&h(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}handleEvent(e){if(e.preventDefault(),this._isLockedEvents)return;const t=e.target;if(!(t instanceof HTMLButtonElement))return;const n=t.parentElement;if(!n)return;const l=Array.prototype.indexOf.call(n.children,t);switch(e.type){case"click":this._hanldeClick(e,l);break;case"dblclick":this._hanldeDoubleClick(l);break;case"contextmenu":this._handleContextMenu(l);break;case"mouseup":this._handleMouseUp(e,l);break;case"keydown":this._handleKeyPress(e)}}_hanldeClick(e,t){this._openCellEvent(t,e.ctrlKey||e.altKey)}_hanldeDoubleClick(e){this._quickOpen(e)}_handleContextMenu(e){1&this._getCell(e)?this._actions.onClickQuickOpenCell(e):this._actions.onClickMarkCell(e)}_handleMouseUp(e,t){2===e.which&&this._quickOpen(t)}_handleKeyPress(e){const{keyCode:t}=e;if(!p.includes(t))return;const n=document.activeElement;if(!(n instanceof HTMLButtonElement))return;const l=n.parentElement;if(!l)return;e.preventDefault(),this._lockEvents(),clearTimeout(this._timer);const s=Array.prototype.indexOf.call(l.children,n);let i=-1;switch(t){case 32:this._handleContextMenu(s);break;case 13:this._openCellEvent(s,!1);break;case 37:i=this._getPrevAvailableId(s-1);break;case 39:i=this._getNextAvailableId(s+1);break;case 38:i=this._getPrevAvailableId(s-this._gameState.game.width);break;case 40:i=this._getNextAvailableId(s+this._gameState.game.width)}l.children[i]&&l.children[i].focus(),this._timer=setTimeout(()=>this._unlockEvents(),100)}_quickOpen(e){const t=this._getCell(e);1&t&&t>>8!=0&&this._actions.onClickQuickOpenCell(e)}_openCellEvent(e,t){const{onClickCell:n,onClickMarkCell:l,onClickQuickOpenCell:s}=this._actions,i=this._getCell(e),a=1&i,r=4&i,o=8&i;t?a?s(e):l(e):a||r||o||n(e)}_getCell(e){return this._gameState.field.field[e]}_getPrevAvailableId(e){for(;e>=0&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e--;return e}_getNextAvailableId(e){for(;e<this._gameState.field.field.length&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e++;return e}_lockEvents(){this._isLockedEvents=!0}_unlockEvents(){this._isLockedEvents=!1}}var C=n(4),v=n.n(C);class b{constructor(){this.element=document.createElement("div")}render(e){this.element.innerHTML=this.renderInfo(e),this.element.className=`${v.a["game-status"]} ${v.a["game-status_state_"+e.state]}`}renderMinesCount(e){return`\n      <span>\n        Mines left: \n      </span>\n      ${e}\n    `}renderWinStatus(e){return`\n      <span>\n        You Winner!!!\n      </span>\n      ${this.renderMinesCount(e)}\n    `}renderInProgress(e){return this.renderMinesCount(e)}renderFail(e){return this.renderMinesCount(e)}renderNotStarted(e){return this.renderMinesCount(e)}renderInfo(e){const{state:t}=e;return"win"===t?this.renderWinStatus(e.minesLeftCount):"in-progress"===t?this.renderInProgress(e.minesLeftCount):"fail"===t?this.renderFail(e.minesLeftCount):this.renderNotStarted(e.minesLeftCount)}}((e,t)=>{const n=()=>{const t=e.game.width*e.game.height;var n,l;t>1e5&&!confirm(`Your field includes ${t} cells. It can takes a time for render`)||(e.game.state="in-progress",e.field.showAllBombs=!1,e.field.field=(n=e.game.width,l=e.game.height,new Uint8Array(l*n)),e.field.isGenerated=!1,r.renderAll())},l=((e,t)=>{const n=document.createElement("form");n.className=s.a.settings;const l=new i({min:"1",max:"10000",value:e.width,title:"Cols"}),a=new i({min:"1",max:"10000",value:e.height,title:"Rows"}),r=new i({min:"1",max:"10000",value:e.minesCount,title:"Mines count"});n.appendChild(l.element),n.appendChild(a.element),n.appendChild(r.element);const o=document.createElement("input");return o.type="submit",o.value="Apply",n.appendChild(o),n.addEventListener("submit",n=>{n.preventDefault(),e.width=parseInt(l.input.value,10),e.height=parseInt(a.input.value,10),e.minesCount=parseInt(r.input.value,10),t()}),n})(e.game,n),a=new b,r=new g({onClickCell(t){e.field.isGenerated||(e.field.field=((e,t,n,l)=>{const s=t*e,i=new Uint8Array(s);let a=s,r=n;for(let e=0;e<s;e++){const t=e!==l&&r>0&&Math.round(Math.random()*a)<r;a--,t&&r--,i[e]=t?2:0}for(let t=0;t<s;t++){let n=0;const l=o(t,e,s);for(const e of l)2&i[e]&&n++;i[t]|=n<<4}return i})(e.game.width,e.game.height,e.game.minesCount,t),e.field.isGenerated=!0),h(t),c()},onClickMarkCell(t){const n=e.field.field[t];8&n?m(t,0,-9):4&n?(m(t,8,-5),e.field.flagsCount--):(m(t,4),e.field.flagsCount++),c()},onClickQuickOpenCell(t){const n=e.field.field[t];if(1&n&&n>>4!=0){let l=0;const s=o(t,e.game.width,e.field.field.length).filter(t=>{const n=e.field.field[t];return 4&n?(l++,!1):0==(9&n)});l===n>>4&&s.forEach(t=>{e.field.field[t]>>4!=0||2&e.field.field[t]?u(t):_(t)})}c()}},e),d=t=>{e.game.state=t?"fail":"win",r.reRenderAll()},c=()=>{const{field:t,game:n}=e;t.showAllBombs&&"fail"!==n.state?d(!0):"in-progress"!==n.state||t.flagsCount+t.openedCount!==t.field.length&&(t.field.length!==t.openedCount+n.minesCount||t.showAllBombs)||d(!1)};t.appendChild(l),t.appendChild(r.element),t.appendChild(a.element),t.appendChild(r.progressElement);const h=t=>{const n=e.field.field[t];n>>4!=0||2&n?u(t):_(t)},u=t=>{1&e.field.field[t]||(2&e.field.field[t]&&(e.field.showAllBombs=!0),e.field.openedCount++,m(t,1))},m=(t,n,l=255)=>{e.field.field[t]|=n,e.field.field[t]&=l,r.renderCell(t),a.render({minesLeftCount:e.game.minesCount-e.field.flagsCount,state:e.game.state})},_=t=>{const n=e.game.width,{field:l}=e.field,s=l.length,i=new Uint8Array(s),a=[t];for(;a.length;){const t=a.pop();if(void 0===t)throw Error("currentId is undefined");if(i[t]=1,!(1&l[t])&&(m(t,1),e.field.openedCount++,l[t]>>4==0)){const e=o(t,n,s);for(let t=e.length-1;t>=0;t--)i[e[t]]||a.push(e[t])}}};n()})({game:{width:16,height:10,minesCount:30,state:"not-started"},field:{field:new Uint8Array,flagsCount:0,openedCount:0,showAllBombs:!1,isGenerated:!1,isRenderInProgres:!1,totalRendered:0}},document.querySelector("#app"))}]);