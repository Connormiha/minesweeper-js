(e=>{var t={};function n(l){if(t[l])return t[l].exports;var i=t[l]={i:l,l:!1,exports:{}};return e[l].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=(e,t,l)=>{n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=(e,t)=>{if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(l,i,(t=>e[t]).bind(null,i));return l},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,"a",t),t},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",n(n.s=6)})([(e,t,n)=>{},(e,t,n)=>{},(e,t,n)=>{},(e,t,n)=>{},(e,t,n)=>{},(e,t,n)=>{},function(e,t,n){"use strict";n.r(t),n(0),n(1);class l{constructor(e){this.element=document.createElement("label"),this.element.className="settings__label",this.element.innerHTML=`\n      <span className="settings__label-text">\n        ${e.title}\n      </span>\n      <input\n        type="number"\n        min="${e.min}"\n        max="${e.max}"\n        value="${e.value}"\n      >\n    `,this.input=this.element.querySelector("input"),this.input.addEventListener("input",()=>{this.input.value=this.input.value.replace(/\D/g,"")})}}n(5);const i=(e,t,n)=>{const l=e%t==0,i=e%t==t-1,s=[];return e+t<n&&s.push(e+t),e-t>=0&&s.push(e-t),l||s.push(e-1,e+t-1,e-t-1),i||s.push(e+1,e+t+1,e-t+1),s.filter(e=>e>=0&&e<n)},s=()=>{const e=document.createElement("button");return e.type="button",e.setAttribute("aria-label","not oppened cell"),e.className="cell cell_close",e},r=(e,t)=>{const n=Boolean(2&e),l=Boolean(1&e),i=n&&l,s=Boolean(4&e),r=Boolean(8&e),a=e>>4,o=["cell"];return l||t&&n?((l||t)&&n&&o.push("cell_bomb"),i?o.push("cell_dead"):o.push("cell_open")):o.push("cell_close"),s&&!l&&o.push("cell_flag"),s&&!n&&t&&o.push("cell_dead"),!r||l||t||n||o.push("cell_question"),a&&l&&!n&&o.push("cell_count_"+a),o.join(" ")},a=Array.from({length:256}).map((e,t)=>r(t,!1)),o=Array.from({length:256}).map((e,t)=>r(t,!0)),d=(e,t,n)=>{const l=Boolean(2&t),i=Boolean(1&t),s=t>>4;e.className=n?o[t]:a[t],e.disabled=i&&0===s,e.setAttribute("aria-label",(e=>4&e?"flag":8&e?"unknown mark":1&e?e>>4!=0?"around bombs "+(e>>4):"opened empty cell":"not oppened cell")(t)),e.textContent=i&&!l&&s?String(s):""};n(4),n(3);const h=[13,32,40,38,37,39];class c{constructor(e,t){this._actions=e,this._isLockedEvents=!1,this._gameState=t,this._progress=(e=>{const t=document.createElement("div");t.className="progress",t.innerHTML='\n    <div class="progress__inner">\n      <div class="progress__progress"></div>\n      <div class="progress__text"></div>\n    </div>\n  ';const n=t.querySelector(".progress__progress"),l=t.querySelector(".progress__text");return{element:t,startUpdateProgress(){t.style.display="flex";const i=()=>{if(!e.isRenderInProgres)return void(t.style.display="none");const s=e.totalRendered/e.field.length*100;n.style.width=s+"%",l.innerHTML=`Rendering ${0|s}%`,requestAnimationFrame(i)};requestAnimationFrame(i)}}})(t.field),this.progressElement=this._progress.element,this.element=document.createElement("div"),this.element.className="field",this.element.addEventListener("click",this),this.element.addEventListener("contextmenu",this),this.element.addEventListener("dblclick",this),this.element.addEventListener("mouseup",this),this.element.addEventListener("keydown",this)}renderAll(){this.element.innerHTML="",this.element.style.width=34*this._gameState.game.width+"px",this.element.className="field",this._gameState.field.isRenderInProgres=!0,this._gameState.field.totalRendered=0,this._batchTimer=setTimeout(()=>{this._gameState.field.isRenderInProgres&&this._gameState.field.totalRendered/this._gameState.field.field.length<.5&&this._progress.startUpdateProgress()},500),this._renderBatch(0,1e4)}_renderBatch(e,t){const n=document.createDocumentFragment(),l=Math.min(this._gameState.field.field.length,e+t);for(let t=e;t<l;t++)n.appendChild(s());this.element.appendChild(n),this._gameState.field.totalRendered=e+t,l<this._gameState.field.field.length?requestAnimationFrame(()=>{this._renderBatch(e+t,t)}):(this._gameState.field.isRenderInProgres=!1,clearInterval(this._batchTimer))}renderCell(e){const t=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className="field "+(t?"field_locked":""),d(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}reRenderAll(){const e=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className="field "+(e?"field_locked":"");for(let e=0;e<this._gameState.field.field.length;e++){const t=this._gameState.field.field[e];2&t&&d(this.element.children[e],t,this._gameState.field.showAllBombs)}}handleEvent(e){if(e.preventDefault(),this._isLockedEvents)return;const t=e.target;if(!(t instanceof HTMLButtonElement))return;const n=t.parentElement;if(!n)return;const l=Array.prototype.indexOf.call(n.children,t);switch(e.type){case"click":this._hanldeClick(e,l);break;case"dblclick":this._hanldeDoubleClick(l);break;case"contextmenu":this._handleContextMenu(l);break;case"mouseup":this._handleMouseUp(e,l);break;case"keydown":this._handleKeyPress(e)}}_hanldeClick(e,t){this._openCellEvent(t,e.ctrlKey||e.altKey)}_hanldeDoubleClick(e){this._quickOpen(e)}_handleContextMenu(e){1&this._getCell(e)?this._actions.onClickQuickOpenCell(e):this._actions.onClickMarkCell(e)}_handleMouseUp(e,t){2===e.which&&this._quickOpen(t)}_handleKeyPress(e){const{keyCode:t}=e;if(!h.includes(t))return;const n=document.activeElement;if(!(n instanceof HTMLButtonElement))return;const l=n.parentElement;if(!l)return;e.preventDefault(),this._lockEvents(),clearTimeout(this._timer);const i=Array.prototype.indexOf.call(l.children,n);let s=-1;switch(t){case 32:this._handleContextMenu(i);break;case 13:this._openCellEvent(i,!1);break;case 37:s=this._getPrevAvailableId(i-1);break;case 39:s=this._getNextAvailableId(i+1);break;case 38:s=this._getPrevAvailableId(i-this._gameState.game.width);break;case 40:s=this._getNextAvailableId(i+this._gameState.game.width)}l.children[s]&&l.children[s].focus(),this._timer=setTimeout(()=>this._unlockEvents(),100)}_quickOpen(e){const t=this._getCell(e);1&t&&t>>8!=0&&this._actions.onClickQuickOpenCell(e)}_openCellEvent(e,t){const{onClickCell:n,onClickMarkCell:l,onClickQuickOpenCell:i}=this._actions,s=this._getCell(e),r=1&s,a=4&s,o=8&s;t?r?i(e):l(e):r||a||o||n(e)}_getCell(e){return this._gameState.field.field[e]}_getPrevAvailableId(e){for(;e>=0&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e--;return e}_getNextAvailableId(e){for(;e<this._gameState.field.field.length&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e++;return e}_lockEvents(){this._isLockedEvents=!0}_unlockEvents(){this._isLockedEvents=!1}}n(2);class m{constructor(){this.element=document.createElement("div")}render(e){this.element.innerHTML=this.renderInfo(e),this.element.className="game-status game-status_state_"+e.state}renderMinesCount(e){return`\n      <span>\n        Mines left: \n      </span>\n      ${e}\n    `}renderWinStatus(e){return`\n      <span>\n        You Winner!!!\n      </span>\n      ${this.renderMinesCount(e)}\n    `}renderInProgress(e){return this.renderMinesCount(e)}renderFail(e){return this.renderMinesCount(e)}renderNotStarted(e){return this.renderMinesCount(e)}renderInfo(e){const{state:t}=e;return"win"===t?this.renderWinStatus(e.minesLeftCount):"in-progress"===t?this.renderInProgress(e.minesLeftCount):"fail"===t?this.renderFail(e.minesLeftCount):this.renderNotStarted(e.minesLeftCount)}}((e,t)=>{const n=()=>{const t=e.game.width*e.game.height;var n,l;t>1e5&&!confirm(`Your field includes ${t} cells. It can takes a time for render`)||(e.game.state="in-progress",e.field.showAllBombs=!1,e.field.field=(n=e.game.width,l=e.game.height,new Uint8Array(l*n)),e.field.isGenerated=!1,a.renderAll())},s=((e,t)=>{const n=document.createElement("form");n.className="settings";const i=new l({min:"1",max:"10000",value:e.width,title:"Cols"}),s=new l({min:"1",max:"10000",value:e.height,title:"Rows"}),r=new l({min:"1",max:"10000",value:e.minesCount,title:"Mines count"});n.appendChild(i.element),n.appendChild(s.element),n.appendChild(r.element);const a=document.createElement("input");return a.type="submit",a.value="Apply",n.appendChild(a),n.addEventListener("submit",n=>{n.preventDefault(),e.width=parseInt(i.input.value,10),e.height=parseInt(s.input.value,10),e.minesCount=parseInt(r.input.value,10),t()}),n})(e.game,n),r=new m,a=new c({onClickCell(t){e.field.isGenerated||(e.field.field=((e,t,n,l)=>{const s=t*e,r=new Uint8Array(s);let a=s,o=n;for(let e=0;e<s;e++){const t=e!==l&&o>0&&Math.round(Math.random()*a)<o;a--,t&&o--,r[e]=t?2:0}for(let t=0;t<s;t++){let n=0;const l=i(t,e,s);for(const e of l)2&r[e]&&n++;r[t]|=n<<4}return r})(e.game.width,e.game.height,e.game.minesCount,t),e.field.isGenerated=!0),h(t),d()},onClickMarkCell(t){const n=e.field.field[t];8&n?f(t,0,-9):4&n?(f(t,8,-5),e.field.flagsCount--):(f(t,4),e.field.flagsCount++),d()},onClickQuickOpenCell(t){const n=e.field.field[t];if(1&n&&n>>4!=0){let l=0;const s=i(t,e.game.width,e.field.field.length).filter(t=>{const n=e.field.field[t];return 4&n?(l++,!1):0==(9&n)});l===n>>4&&s.forEach(t=>{e.field.field[t]>>4!=0||2&e.field.field[t]?u(t):p(t)})}d()}},e),o=t=>{e.game.state=t?"fail":"win",a.reRenderAll()},d=()=>{const{field:t,game:n}=e;t.showAllBombs&&"fail"!==n.state?o(!0):"in-progress"!==n.state||t.flagsCount+t.openedCount!==t.field.length&&(t.field.length!==t.openedCount+n.minesCount||t.showAllBombs)||o(!1)};t.appendChild(s),t.appendChild(a.element),t.appendChild(r.element),t.appendChild(a.progressElement);const h=t=>{const n=e.field.field[t];n>>4!=0||2&n?u(t):p(t)},u=t=>{1&e.field.field[t]||(2&e.field.field[t]&&(e.field.showAllBombs=!0),e.field.openedCount++,f(t,1))},f=(t,n,l=255)=>{e.field.field[t]|=n,e.field.field[t]&=l,a.renderCell(t),r.render({minesLeftCount:e.game.minesCount-e.field.flagsCount,state:e.game.state})},p=t=>{const n=e.game.width,{field:l}=e.field,s=l.length,r=new Uint8Array(s),a=[t];for(;a.length;){const t=a.pop();if(void 0===t)throw Error("currentId is undefined");if(r[t]=1,!(1&l[t])&&(f(t,1),e.field.openedCount++,l[t]>>4==0)){const e=i(t,n,s);for(let t=e.length-1;t>=0;t--)r[e[t]]||a.push(e[t])}}};n()})({game:{width:16,height:10,minesCount:30,state:"not-started"},field:{field:new Uint8Array,flagsCount:0,openedCount:0,showAllBombs:!1,isGenerated:!1,isRenderInProgres:!1,totalRendered:0}},document.querySelector("#app"))}]);