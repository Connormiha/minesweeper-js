(e=>{var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=(e,t,i)=>{n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=(e,t)=>{if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,(t=>e[t]).bind(null,s));return i},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,"a",t),t},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",n(n.s=7)})([(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={throwOnError:!1,elementDelimiter:"__",modifierDelimiter:"_"};function s(e,t,n,s,l){var r=n&&"object"==typeof n,a=r?n:s,o=r?s:l,d=r?"":n,h=i.modifierDelimiter,c=i.throwOnError,u=d?""+t+i.elementDelimiter+d:t,_=e[u]||"";return a&&(_=Object.keys(a).reduce((t,n)=>{var i,s=a[n];if(void 0===s)return t;if("boolean"==typeof s){if(!s)return t;i=e[""+u+h+n]}else{var l=""+u+h+n+h+a[n];i=e[l]}return t+" "+i},_)),o&&(_=Object.keys(o).reduce((t,n)=>{if(!o[n])return t;var i=e["is-"+n];if(!i){if(c)throw Error("There is no is-"+n+" in cssModule");return t}return t+" "+i},_)),_.trim()}var l=(e,t)=>s.bind(null,e,t||(e=>{var t=Object.keys(e)[0],n=t.indexOf(i.elementDelimiter);-1!==n&&(t=t.slice(0,n));var s=t.indexOf(i.modifierDelimiter);return-1!==s&&(t=t.slice(0,s)),t})(e));l.setSettings=e=>Object.assign(i,e),t.default=l},(e,t,n)=>{e.exports={progress:"_3O2Zg",progress__inner:"_2dnQF",progress__progress:"_1Yi6_",progress__text:"_2Cw3v"}},(e,t,n)=>{e.exports={settings:"_1cIiY",settings__label:"_19BCw","settings__label-text":"_1swJ-",settings__input:"gXEsr"}},(e,t,n)=>{e.exports={"game-status":"reZE7","game-status_state_win":"_1Qbcz","game-status_state_in-progress":"_2Wdms","game-status_state_not-started":"_1Q3bf","game-status_state_fail":"_1DUz7"}},(e,t,n)=>{e.exports={field:"_10poZ",field_locked:"HZ_Pl"}},(e,t,n)=>{e.exports={cell:"pxyUi",cell_open:"_2wwoB",cell_close:"_2nTbE",cell_bomb:"_3PRJQ",cell_flag:"_2nKhp",cell_question:"oHTVa",cell_dead:"_2VUvb",cell_count_1:"lEzDG",cell_count_2:"_3utag",cell_count_3:"_1AAqD",cell_count_4:"_173H7",cell_count_5:"_1RWxi",cell_count_6:"_3Q4iU",cell_count_7:"_2p6jV",cell_count_8:"z2f4g"}},(e,t,n)=>{},function(e,t,n){"use strict";n.r(t),n(6);var i=n(0),s=n.n(i),l=n(2),r=n.n(l);const a=s()(r.a),o=a("label"),d=a("label-text");class h{constructor(e){this.element=document.createElement("label"),this.element.className=o,this.element.innerHTML=`\n      <span className="${d}">\n        ${e.title}\n      </span>\n      <input\n        type="number"\n        min="${e.min}"\n        max="${e.max}"\n        value="${e.value}"\n      >\n    `,this.input=this.element.querySelector("input"),this.input.addEventListener("input",()=>{this.input.value=this.input.value.replace(/\D/g,"")})}}class c{constructor(e,t){this._actions=t,this._game=e,this.element=document.createElement("form"),this.element.className=a(),this.element.addEventListener("submit",this),this._inputWidth=new h({min:"1",max:"10000",value:e.width,title:"Cols"}),this._inputHeight=new h({min:"1",max:"10000",value:e.height,title:"Rows"}),this._inputMinesCount=new h({min:"1",max:"10000",value:e.minesCount,title:"Mines count"}),this.element.appendChild(this._inputWidth.element),this.element.appendChild(this._inputHeight.element),this.element.appendChild(this._inputMinesCount.element);const n=document.createElement("input");n.type="submit",n.value="Apply",this.element.appendChild(n)}handleEvent(e){e.preventDefault(),this._game.width=parseInt(this._inputWidth.input.value,10),this._game.height=parseInt(this._inputHeight.input.value,10),this._game.minesCount=parseInt(this._inputMinesCount.input.value,10),this._actions.onStart()}}var u=n(5),_=n.n(u);const m=(e,t,n)=>{const i=e%t==0,s=e%t==t-1,l=[];return e+t<n&&l.push(e+t),e-t>=0&&l.push(e-t),i||l.push(e-1,e+t-1,e-t-1),s||l.push(e+1,e+t+1,e-t+1),l.filter(e=>e>=0&&e<n)},f=s()(_.a),p=f({close:!0}),g=()=>{const e=document.createElement("button");return e.type="button",e.setAttribute("aria-label","not oppened cell"),e.className=p,e},C=(e,t,n)=>{const i=Boolean(2&t),s=Boolean(1&t),l=t>>4,r={open:s||n&&i,close:!(s||n&&i),bomb:(s||n)&&i,dead:i&&s,flag:Boolean(4&t)&&!s,question:Boolean(8&t)&&!s};l&&s&&!i&&(r.count=l),e.className=f(r),e.disabled=s&&0===l,e.setAttribute("aria-label",(e=>4&e?"flag":8&e?"unknown mark":1&e?e>>4!=0?"around bombs "+(e>>4):"opened empty cell":"not oppened cell")(t)),e.textContent=s&&!i&&l?String(l):""};var v=n(1),b=n.n(v),k=n(4),w=n.n(k);const S=s()(w.a),y=[13,32,40,38,37,39];class E{constructor(e,t){this._actions=e,this._isLockedEvents=!1,this._gameState=t,this._progress=(e=>{const t=document.createElement("div");t.className=b.a.progress,t.innerHTML=`\n    <div class="${b.a.progress__inner}">\n      <div class="${b.a.progress__progress}"></div>\n      <div class="${b.a.progress__text}"></div>\n    </div>\n  `;const n=t.querySelector("."+b.a.progress__progress),i=t.querySelector("."+b.a.progress__text);return{element:t,startUpdateProgress(){t.style.display="flex";const s=()=>{if(!e.isRenderInProgres)return void(t.style.display="none");const l=e.totalRendered/e.field.length*100;n.style.width=l+"%",i.innerHTML=`Rendering ${0|l}%`,requestAnimationFrame(s)};requestAnimationFrame(s)}}})(t.field),this.progressElement=this._progress.element,this.element=document.createElement("div"),this.element.className=S(),this.element.addEventListener("click",this),this.element.addEventListener("contextmenu",this),this.element.addEventListener("dblclick",this),this.element.addEventListener("mouseup",this),this.element.addEventListener("keydown",this)}renderAll(){this.element.innerHTML="",this.element.style.width=34*this._gameState.game.width+"px",this.element.className=S(),this._gameState.field.isRenderInProgres=!0,this._gameState.field.totalRendered=0,this._batchTimer=setTimeout(()=>{this._gameState.field.isRenderInProgres&&this._gameState.field.totalRendered/this._gameState.field.field.length<.5&&this._progress.startUpdateProgress()},500),this._renderBatch(0,1e4)}_renderBatch(e,t){const n=document.createDocumentFragment(),i=Math.min(this._gameState.field.field.length,e+t);for(let t=e;t<i;t++)n.appendChild(g());this.element.appendChild(n),this._gameState.field.totalRendered=e+t,i<this._gameState.field.field.length?requestAnimationFrame(()=>{this._renderBatch(e+t,t)}):(this._gameState.field.isRenderInProgres=!1,clearInterval(this._batchTimer))}renderCell(e){this.element.className=S({locked:this._gameState.field.showAllBombs||"win"===this._gameState.game.state}),C(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}reRenderAll(){this.element.className=S({locked:this._gameState.field.showAllBombs||"win"===this._gameState.game.state});for(let e=0;e<this._gameState.field.field.length;e++)2&e&&C(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}handleEvent(e){if(e.preventDefault(),this._isLockedEvents)return;const t=e.target;if(!(t instanceof HTMLButtonElement))return;const n=t.parentElement;if(!n)return;const i=Array.prototype.indexOf.call(n.children,t);switch(e.type){case"click":this._hanldeClick(e,i);break;case"dblclick":this._hanldeDoubleClick(i);break;case"contextmenu":this._handleContextMenu(i);break;case"mouseup":this._handleMouseUp(e,i);break;case"keydown":this._handleKeyPress(e)}}_hanldeClick(e,t){this._openCellEvent(t,e.ctrlKey||e.altKey)}_hanldeDoubleClick(e){this._quickOpen(e)}_handleContextMenu(e){1&this._getCell(e)?this._actions.onClickQuickOpenCell(e):this._actions.onClickMarkCell(e)}_handleMouseUp(e,t){2===e.which&&this._quickOpen(t)}_handleKeyPress(e){const{keyCode:t}=e;if(!y.includes(t))return;const n=document.activeElement;if(!(n instanceof HTMLButtonElement))return;const i=n.parentElement;if(!i)return;e.preventDefault(),this._lockEvents(),clearTimeout(this._timer);const s=Array.prototype.indexOf.call(i.children,n);let l=-1;switch(t){case 32:this._handleContextMenu(s);break;case 13:this._openCellEvent(s,!1);break;case 37:l=this._getPrevAvailableId(s-1);break;case 39:l=this._getNextAvailableId(s+1);break;case 38:l=this._getPrevAvailableId(s-this._gameState.game.width);break;case 40:l=this._getNextAvailableId(s+this._gameState.game.width)}i.children[l]&&i.children[l].focus(),this._timer=setTimeout(()=>this._unlockEvents(),100)}_quickOpen(e){const t=this._getCell(e);1&t&&t>>8!=0&&this._actions.onClickQuickOpenCell(e)}_openCellEvent(e,t){const{onClickCell:n,onClickMarkCell:i,onClickQuickOpenCell:s}=this._actions,l=this._getCell(e),r=1&l,a=4&l,o=8&l;t?r?s(e):i(e):r||a||o||n(e)}_getCell(e){return this._gameState.field.field[e]}_getPrevAvailableId(e){for(;e>=0&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e--;return e}_getNextAvailableId(e){for(;e<this._gameState.field.field.length&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e++;return e}_lockEvents(){this._isLockedEvents=!0}_unlockEvents(){this._isLockedEvents=!1}}var x=n(3),A=n.n(x);const M=s()(A.a);class O{constructor(){this.element=document.createElement("div")}render(e){this.element.innerHTML=this.renderInfo(e),this.element.className=M("",{state:e.state})}renderMinesCount(e){return`\n      <span>\n        Mines left: \n      </span>\n      ${e}\n    `}renderWinStatus(e){return`\n      <span>\n        You Winner!!!\n      </span>\n      ${this.renderMinesCount(e)}\n    `}renderInProgress(e){return this.renderMinesCount(e)}renderFail(e){return this.renderMinesCount(e)}renderNotStarted(e){return this.renderMinesCount(e)}renderInfo(e){const{state:t}=e;return"win"===t?this.renderWinStatus(e.minesLeftCount):"in-progress"===t?this.renderInProgress(e.minesLeftCount):"fail"===t?this.renderFail(e.minesLeftCount):this.renderNotStarted(e.minesLeftCount)}}var L={game:{width:16,height:10,minesCount:30,state:"not-started"},field:{field:new Uint8Array,flagsCount:0,openedCount:0,showAllBombs:!1,isGenerated:!1,isRenderInProgres:!1,totalRendered:0}};new class{constructor(e){this._root=e,this._settings=new c(L.game,{onStart:()=>this.onStart()}),this._gameStatus=new O,this._field=new E({onClickCell:e=>{L.field.isGenerated||(L.field.field=((e,t,n,i)=>{const s=t*e,l=new Uint8Array(s);let r=s,a=n;for(let e=0;e<s;e++){const t=e!==i&&a>0&&Math.round(Math.random()*r)<a;r--,t&&a--,l[e]=t?2:0}for(let t=0;t<s;t++){let n=0;const i=m(t,e,s);for(const e of i)2&l[e]&&n++;l[t]|=n<<4}return l})(L.game.width,L.game.height,L.game.minesCount,e),L.field.isGenerated=!0),this._cellOpen(e),this._checkFinish(),this._gameStatus.render({minesLeftCount:L.game.minesCount-L.field.flagsCount,state:L.game.state})},onClickMarkCell:e=>{const t=L.field.field[e];8&t?this._updateCell(e,0,-9):4&t?(this._updateCell(e,8,-5),L.field.flagsCount--):(this._updateCell(e,4),L.field.flagsCount++),this._checkFinish()},onClickQuickOpenCell:e=>{const t=L.field.field[e];if(1&t&&t>>4!=0){let n=0;const i=m(e,L.game.width,L.field.field.length).filter(e=>{const t=L.field.field[e];return 4&t?(n++,!1):0==(9&t)});n===t>>4&&i.forEach(e=>{L.field.field[e]>>4!=0||2&L.field.field[e]?this._openCellState(e):this._openAllowedSiblings(e)})}this._checkFinish()}},L),this._root.appendChild(this._settings.element),this._root.appendChild(this._field.element),this._root.appendChild(this._gameStatus.element),this._root.appendChild(this._field.progressElement),this.onStart()}onStart(){const e=L.game.width*L.game.height;var t,n;e>1e5&&!confirm(`Your field includes ${e} cells. It can takes a time for render`)||(L.game.state="in-progress",L.field.showAllBombs=!1,L.field.field=(t=L.game.width,n=L.game.height,new Uint8Array(n*t)),L.field.isGenerated=!1,this._field.renderAll())}_cellOpen(e){const t=L.field.field[e];t>>4!=0||2&t?this._openCellState(e):this._openAllowedSiblings(e)}_openCellState(e){1&L.field.field[e]||(2&L.field.field[e]&&(L.field.showAllBombs=!0),L.field.openedCount++,this._updateCell(e,1))}_updateCell(e,t,n=255){L.field.field[e]|=t,L.field.field[e]&=n,this._field.renderCell(e)}_openAllowedSiblings(e){const t=L.game.width,{field:n}=L.field,i=n.length,s=new Uint8Array(i),l=[e];for(;l.length;){const e=l.pop();if(void 0===e)throw Error("currentId is undefined");if(s[e]=1,!(1&n[e])&&(this._updateCell(e,1),L.field.openedCount++,n[e]>>4==0)){const n=m(e,t,i);for(let e=n.length-1;e>=0;e--)s[n[e]]||l.push(n[e])}}}_checkFinish(){const{field:e,game:t}=L;e.showAllBombs&&"fail"!==t.state?this._onFinishGame(!0):"in-progress"!==t.state||e.flagsCount+e.openedCount!==e.field.length&&(e.field.length!==e.openedCount+t.minesCount||e.showAllBombs)||this._onFinishGame(!1)}_onFinishGame(e){L.game.state=e?"fail":"win",this._field.reRenderAll()}}(document.querySelector("#app"))}]);