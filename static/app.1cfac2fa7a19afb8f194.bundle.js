(e=>{var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=(e,t,i)=>{n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=(e,t)=>{if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,(t=>e[t]).bind(null,s));return i},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,"a",t),t},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/",n(n.s=6)})([(e,t,n)=>{e.exports={cell:"pxyU",cell_open:"_2wwo",cell_close:"_2nTb",cell_bomb:"_3PRJ",cell_flag:"_2nKh",cell_question:"oHTV",cell_dead:"_2VUv",cell_count_1:"lEzD",cell_count_2:"_3uta",cell_count_3:"_1AAq",cell_count_4:"_173H",cell_count_5:"_1RWx",cell_count_6:"_3Q4i",cell_count_7:"_2p6j",cell_count_8:"z2f4"}},(e,t,n)=>{e.exports={field:"_10po",field_locked:"HZ_P"}},(e,t,n)=>{e.exports={progress:"_3O2Z",progress__inner:"_2dnQ",progress__progress:"_1Yi6",progress__text:"_2Cw3"}},(e,t,n)=>{e.exports={settings:"_1cIi",settings__label:"_19BC","settings__label-text":"_1swJ",settings__input:"gXEs"}},(e,t,n)=>{e.exports={"game-status":"reZE","game-status_state_win":"_1Qbc","game-status_state_in-progress":"_2Wdm","game-status_state_not-started":"_1Q3b","game-status_state_fail":"_1DUz"}},(e,t,n)=>{},function(e,t,n){"use strict";n.r(t),n(5);var i=n(3),s=n.n(i);class l{constructor(e){this.element=document.createElement("label"),this.element.className=s.a.settings__label,this.element.innerHTML=`\n      <span className="${s.a["settings__label-text"]}">\n        ${e.title}\n      </span>\n      <input\n        type="number"\n        min="${e.min}"\n        max="${e.max}"\n        value="${e.value}"\n      >\n    `,this.input=this.element.querySelector("input"),this.input.addEventListener("input",()=>{this.input.value=this.input.value.replace(/\D/g,"")})}}class a{constructor(e,t){this._actions=t,this._game=e,this.element=document.createElement("form"),this.element.className=s.a.settings,this.element.addEventListener("submit",this),this._inputWidth=new l({min:"1",max:"10000",value:e.width,title:"Cols"}),this._inputHeight=new l({min:"1",max:"10000",value:e.height,title:"Rows"}),this._inputMinesCount=new l({min:"1",max:"10000",value:e.minesCount,title:"Mines count"}),this.element.appendChild(this._inputWidth.element),this.element.appendChild(this._inputHeight.element),this.element.appendChild(this._inputMinesCount.element);const n=document.createElement("input");n.type="submit",n.value="Apply",this.element.appendChild(n)}handleEvent(e){e.preventDefault(),this._game.width=parseInt(this._inputWidth.input.value,10),this._game.height=parseInt(this._inputHeight.input.value,10),this._game.minesCount=parseInt(this._inputMinesCount.input.value,10),this._actions.onStart()}}var r=n(0),o=n.n(r);const d=(e,t,n)=>{const i=e%t==0,s=e%t==t-1,l=[];return e+t<n&&l.push(e+t),e-t>=0&&l.push(e-t),i||l.push(e-1,e+t-1,e-t-1),s||l.push(e+1,e+t+1,e-t+1),l.filter(e=>e>=0&&e<n)},h=`${o.a.cell} ${o.a.cell_close}`,c=()=>{const e=document.createElement("button");return e.type="button",e.setAttribute("aria-label","not oppened cell"),e.className=h,e},_=(e,t,n)=>{const i=Boolean(2&t),s=Boolean(1&t),l=i&&s,a=Boolean(4&t),r=Boolean(8&t),d=t>>4,h=[o.a.cell];s||n&&i?(h.push(o.a.cell_open),(s||n)&&i&&h.push(o.a.cell_bomb),l&&h.push(o.a.cell_dead)):h.push(o.a.cell_close),!a||s||n||i||h.push(o.a.cell_flag),!r||s||n||i||h.push(o.a.cell_question),d&&s&&!i&&h.push(o.a["cell_count_"+d]),e.className=h.join(" "),e.disabled=s&&0===d,e.setAttribute("aria-label",(e=>4&e?"flag":8&e?"unknown mark":1&e?e>>4!=0?"around bombs "+(e>>4):"opened empty cell":"not oppened cell")(t)),e.textContent=s&&!i&&d?String(d):""};var u=n(2),m=n.n(u),p=n(1),f=n.n(p);const g=[13,32,40,38,37,39];class C{constructor(e,t){this._actions=e,this._isLockedEvents=!1,this._gameState=t,this._progress=(e=>{const t=document.createElement("div");t.className=m.a.progress,t.innerHTML=`\n    <div class="${m.a.progress__inner}">\n      <div class="${m.a.progress__progress}"></div>\n      <div class="${m.a.progress__text}"></div>\n    </div>\n  `;const n=t.querySelector("."+m.a.progress__progress),i=t.querySelector("."+m.a.progress__text);return{element:t,startUpdateProgress(){t.style.display="flex";const s=()=>{if(!e.isRenderInProgres)return void(t.style.display="none");const l=e.totalRendered/e.field.length*100;n.style.width=l+"%",i.innerHTML=`Rendering ${0|l}%`,requestAnimationFrame(s)};requestAnimationFrame(s)}}})(t.field),this.progressElement=this._progress.element,this.element=document.createElement("div"),this.element.className=f.a.field,this.element.addEventListener("click",this),this.element.addEventListener("contextmenu",this),this.element.addEventListener("dblclick",this),this.element.addEventListener("mouseup",this),this.element.addEventListener("keydown",this)}renderAll(){this.element.innerHTML="",this.element.style.width=34*this._gameState.game.width+"px",this.element.className=f.a.field,this._gameState.field.isRenderInProgres=!0,this._gameState.field.totalRendered=0,this._batchTimer=setTimeout(()=>{this._gameState.field.isRenderInProgres&&this._gameState.field.totalRendered/this._gameState.field.field.length<.5&&this._progress.startUpdateProgress()},500),this._renderBatch(0,1e4)}_renderBatch(e,t){const n=document.createDocumentFragment(),i=Math.min(this._gameState.field.field.length,e+t);for(let t=e;t<i;t++)n.appendChild(c());this.element.appendChild(n),this._gameState.field.totalRendered=e+t,i<this._gameState.field.field.length?requestAnimationFrame(()=>{this._renderBatch(e+t,t)}):(this._gameState.field.isRenderInProgres=!1,clearInterval(this._batchTimer))}renderCell(e){const t=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className=`${f.a.field} ${t?f.a.field_locked:""}`,_(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}reRenderAll(){const e=this._gameState.field.showAllBombs||"win"===this._gameState.game.state;this.element.className=`${f.a.field} ${e?f.a.field_locked:""}`;for(let e=0;e<this._gameState.field.field.length;e++)2&e&&_(this.element.children[e],this._gameState.field.field[e],this._gameState.field.showAllBombs)}handleEvent(e){if(e.preventDefault(),this._isLockedEvents)return;const t=e.target;if(!(t instanceof HTMLButtonElement))return;const n=t.parentElement;if(!n)return;const i=Array.prototype.indexOf.call(n.children,t);switch(e.type){case"click":this._hanldeClick(e,i);break;case"dblclick":this._hanldeDoubleClick(i);break;case"contextmenu":this._handleContextMenu(i);break;case"mouseup":this._handleMouseUp(e,i);break;case"keydown":this._handleKeyPress(e)}}_hanldeClick(e,t){this._openCellEvent(t,e.ctrlKey||e.altKey)}_hanldeDoubleClick(e){this._quickOpen(e)}_handleContextMenu(e){1&this._getCell(e)?this._actions.onClickQuickOpenCell(e):this._actions.onClickMarkCell(e)}_handleMouseUp(e,t){2===e.which&&this._quickOpen(t)}_handleKeyPress(e){const{keyCode:t}=e;if(!g.includes(t))return;const n=document.activeElement;if(!(n instanceof HTMLButtonElement))return;const i=n.parentElement;if(!i)return;e.preventDefault(),this._lockEvents(),clearTimeout(this._timer);const s=Array.prototype.indexOf.call(i.children,n);let l=-1;switch(t){case 32:this._handleContextMenu(s);break;case 13:this._openCellEvent(s,!1);break;case 37:l=this._getPrevAvailableId(s-1);break;case 39:l=this._getNextAvailableId(s+1);break;case 38:l=this._getPrevAvailableId(s-this._gameState.game.width);break;case 40:l=this._getNextAvailableId(s+this._gameState.game.width)}i.children[l]&&i.children[l].focus(),this._timer=setTimeout(()=>this._unlockEvents(),100)}_quickOpen(e){const t=this._getCell(e);1&t&&t>>8!=0&&this._actions.onClickQuickOpenCell(e)}_openCellEvent(e,t){const{onClickCell:n,onClickMarkCell:i,onClickQuickOpenCell:s}=this._actions,l=this._getCell(e),a=1&l,r=4&l,o=8&l;t?a?s(e):i(e):a||r||o||n(e)}_getCell(e){return this._gameState.field.field[e]}_getPrevAvailableId(e){for(;e>=0&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e--;return e}_getNextAvailableId(e){for(;e<this._gameState.field.field.length&&1&this._getCell(e)&&this._getCell(e)>>8==0;)e++;return e}_lockEvents(){this._isLockedEvents=!0}_unlockEvents(){this._isLockedEvents=!1}}var v=n(4),b=n.n(v);class k{constructor(){this.element=document.createElement("div")}render(e){this.element.innerHTML=this.renderInfo(e),this.element.className=`${b.a["game-status"]} ${b.a["game-status_state_"+e.state]}`}renderMinesCount(e){return`\n      <span>\n        Mines left: \n      </span>\n      ${e}\n    `}renderWinStatus(e){return`\n      <span>\n        You Winner!!!\n      </span>\n      ${this.renderMinesCount(e)}\n    `}renderInProgress(e){return this.renderMinesCount(e)}renderFail(e){return this.renderMinesCount(e)}renderNotStarted(e){return this.renderMinesCount(e)}renderInfo(e){const{state:t}=e;return"win"===t?this.renderWinStatus(e.minesLeftCount):"in-progress"===t?this.renderInProgress(e.minesLeftCount):"fail"===t?this.renderFail(e.minesLeftCount):this.renderNotStarted(e.minesLeftCount)}}var w={game:{width:16,height:10,minesCount:30,state:"not-started"},field:{field:new Uint8Array,flagsCount:0,openedCount:0,showAllBombs:!1,isGenerated:!1,isRenderInProgres:!1,totalRendered:0}};new class{constructor(e){this._root=e,this._settings=new a(w.game,{onStart:()=>this.onStart()}),this._gameStatus=new k,this._field=new C({onClickCell:e=>{w.field.isGenerated||(w.field.field=((e,t,n,i)=>{const s=t*e,l=new Uint8Array(s);let a=s,r=n;for(let e=0;e<s;e++){const t=e!==i&&r>0&&Math.round(Math.random()*a)<r;a--,t&&r--,l[e]=t?2:0}for(let t=0;t<s;t++){let n=0;const i=d(t,e,s);for(const e of i)2&l[e]&&n++;l[t]|=n<<4}return l})(w.game.width,w.game.height,w.game.minesCount,e),w.field.isGenerated=!0),this._cellOpen(e),this._checkFinish()},onClickMarkCell:e=>{const t=w.field.field[e];8&t?this._updateCell(e,0,-9):4&t?(this._updateCell(e,8,-5),w.field.flagsCount--):(this._updateCell(e,4),w.field.flagsCount++),this._checkFinish()},onClickQuickOpenCell:e=>{const t=w.field.field[e];if(1&t&&t>>4!=0){let n=0;const i=d(e,w.game.width,w.field.field.length).filter(e=>{const t=w.field.field[e];return 4&t?(n++,!1):0==(9&t)});n===t>>4&&i.forEach(e=>{w.field.field[e]>>4!=0||2&w.field.field[e]?this._openCellState(e):this._openAllowedSiblings(e)})}this._checkFinish()}},w),this._root.appendChild(this._settings.element),this._root.appendChild(this._field.element),this._root.appendChild(this._gameStatus.element),this._root.appendChild(this._field.progressElement),this.onStart()}onStart(){const e=w.game.width*w.game.height;var t,n;e>1e5&&!confirm(`Your field includes ${e} cells. It can takes a time for render`)||(w.game.state="in-progress",w.field.showAllBombs=!1,w.field.field=(t=w.game.width,n=w.game.height,new Uint8Array(n*t)),w.field.isGenerated=!1,this._field.renderAll())}_cellOpen(e){const t=w.field.field[e];t>>4!=0||2&t?this._openCellState(e):this._openAllowedSiblings(e)}_openCellState(e){1&w.field.field[e]||(2&w.field.field[e]&&(w.field.showAllBombs=!0),w.field.openedCount++,this._updateCell(e,1))}_updateCell(e,t,n=255){w.field.field[e]|=t,w.field.field[e]&=n,this._field.renderCell(e),this._gameStatus.render({minesLeftCount:w.game.minesCount-w.field.flagsCount,state:w.game.state})}_openAllowedSiblings(e){const t=w.game.width,{field:n}=w.field,i=n.length,s=new Uint8Array(i),l=[e];for(;l.length;){const e=l.pop();if(void 0===e)throw Error("currentId is undefined");if(s[e]=1,!(1&n[e])&&(this._updateCell(e,1),w.field.openedCount++,n[e]>>4==0)){const n=d(e,t,i);for(let e=n.length-1;e>=0;e--)s[n[e]]||l.push(n[e])}}}_checkFinish(){const{field:e,game:t}=w;e.showAllBombs&&"fail"!==t.state?this._onFinishGame(!0):"in-progress"!==t.state||e.flagsCount+e.openedCount!==e.field.length&&(e.field.length!==e.openedCount+t.minesCount||e.showAllBombs)||this._onFinishGame(!1)}_onFinishGame(e){w.game.state=e?"fail":"win",this._field.reRenderAll()}}(document.querySelector("#app"))}]);